<!DOCTYPE html>
<html>
    <head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js"></script>

<style>
    html,body {
        height: 100%; 
        margin: 0px; 
        padding: 0px; 
    }

    #map {
        width: 100%;
        height: 100%;
    }

    .legend-color-block {
      width: 1rem;
      height: 1rem;
    }

    .leaflet-control-layers-selector {
      top: 0px;
      width: 1rem;
      margin-top: 0px;
      margin-bottom: 0.125rem;
      vertical-align: middle;
    }
</style>
</head>
<body>
    <div id="map"></div>
</body>
<script>
    const filteredDataJSON = [];
    const latLngs = [];

    let map;

    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
    {
        minZoom: 7,
        maxZoom: 21,
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    });

    const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', 
    {
        minZoom: 7,
        maxZoom: 21,
        attribution: '© <a href="https://www.esri.com/en-us/home">Esri</a>, <a href="https://www.earthstar.com/">Earthstar Geographics</a>, <a href="https://www.maxar.com/">Maxar</a>, <a href="https://www.usda.gov/">USDA</a>, <a href="https://www.usgs.gov/">USGS</a>, <a href="https://www.aex.com/">AEX</a>, <a href="https://www.getmapping.com/">Getmapping</a>, <a href="https://www.aerogrid.com/">Aerogrid</a>, <a href="https://www.ign.fr/">IGN</a>, <a href="https://www.igp.pt/">IGP</a>, and the <a href="https://www.gisusercommunity.com/">GIS User Community</a>'
    });

    const baseMaps = 
    {
        "OpenStreetMap": osm,
        "Esri Satellite": satellite
    };

    const overlayMaps = {
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #008000;"></span> -85 dBm and above</span>']: L.layerGroup(),
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #90EE90;"></span> between -86 dBm and -100 dBm</span>']: L.layerGroup(),
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #FFCCCB;"></span> between -101 dBm and -115 dBm</span>']: L.layerGroup(),
        ['<span class="d-block cursor-default"><span class="legend-color-block align-middle border border-secondary-subtle d-inline-block" style="background-color: #FF0000;"></span> -116 dBm and below</span>']: L.layerGroup()
    };

    function createMap()
    {
        map = map = L.map("map",{zoomControl: false}).setView([47.6965, 13.3457], 7);
        osm.addTo(map);
        const layersControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        const checkboxes = layersControl.getContainer().querySelectorAll('.leaflet-control-layers-list input[type="checkbox"]');
        checkboxes.forEach(function(cb) {
            const label = cb.closest('label');
            const labelClone = label.cloneNode(true);
            labelClone.querySelector('input[type="checkbox"]').remove();
            label.parentNode.replaceChild(labelClone.querySelector('.d-block.cursor-default'), label);
      });
    }

    function addDataToMap(dataJSON) {
        let markerLayer = L.layerGroup();

        dataJSON.forEach(entry => {
            let marker = L.circleMarker([entry.Latitude, entry.Longitude], entry.Icon);

            marker.bindPopup(entry.PopUp);
            marker.bindTooltip(entry.ToolTip, {permanent: false, direction: 'top', offset: [0, -8], opacity: 1});
            marker.addTo(markerLayer);
        });

        markerLayer.addTo(map);
        const bounds = L.latLngBounds(latLngs);
        map.fitBounds(bounds.pad(0.2), { maxZoom: 19 });
    }

    createMap();
    addDataToMap(filteredDataJSON);
</script>
</html>